generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Define enums for board, medium, and school type
enum Board {
  CBSE
  ICSE
  STATE
  IB
  CAMBRIDGE
}

enum Medium {
  English
  Hindi
  Regional
}

enum SchoolType {
  Private
  Government
  Aided
  International
}

model School {
  code              String     @id
  name              String
  affiliationNumber String? // optional
  board             Board
  medium            Medium
  establishmentYear Int? // optional
  schoolType        SchoolType
  contactEmail      String? // optional
  contactPhone      String? // optional
  website           String? // optional
  logoUrl           String? // optional
  address           Address    @relation(fields: [addressId], references: [id])
  addressId         String

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  Admin     Admin[]
  Teacher   Teacher[]
  Class     Class[]
}

// Example Address model
model Address {
  id      String   @id @default(cuid())
  street  String
  city    String
  state   String
  country String
  zipCode String
  schools School[]
}

model Admin {
  id          String @id @default(cuid())
  username    String @unique
  password    String
  designation String
  school      School @relation(fields: [schoolCode], references: [code])
  schoolCode  String
  role        Role   @relation(fields: [roleId], references: [id])
  roleId      String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum RoleName {
  admin
  teacher
  student
  parent
  staff
}

model Role {
  id          String   @id @default(cuid())
  name        RoleName @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  admins     Admin[]
  Permission Permission[]
  Teacher    Teacher[]
  Student    Student[]
}

model Permission {
  id         String  @id @default(cuid())
  module     String
  can_create Boolean @default(false)
  can_read   Boolean @default(false)
  can_update Boolean @default(false)
  can_delete Boolean @default(false)
  role       Role    @relation(fields: [roleId], references: [id])
  roleId     String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([roleId, module])
}

enum TeacherStatus {
  ACTIVE
  INACTIVE
}

model Teacher {
  id          String        @id @default(cuid())
  fullName    String
  email       String        @unique
  phone       String
  password    String
  role        Role?         @relation(fields: [roleId], references: [id])
  roleId      String?
  school      School?       @relation(fields: [schoolCode], references: [code])
  schoolCode  String?
  designation String
  status      TeacherStatus @default(ACTIVE)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  Section   Section[]
}

enum Gender {
  Male
  Female
  Other
}

enum StudentStatus {
  ACTIVE
  INACTIVE
  LEFT
  TRANSFERRED
}

model Student {
  id          String        @id @default(cuid())
  name        String
  dob         DateTime
  gender      Gender
  address     String
  email       String        @unique
  phone       String
  photo       String?
  admissionNo String        @unique
  aadhar      String        @unique
  category    String
  role        Role          @relation(fields: [roleId], references: [id])
  roleId      String
  class       Class         @relation(fields: [classId], references: [id])
  classId     String
  section     Section       @relation(fields: [sectionId], references: [id])
  sectionId   String
  status      StudentStatus @default(ACTIVE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Class {
  id         String    @id @default(cuid())
  name       String
  standard   Int
  school     School    @relation(fields: [schoolCode], references: [code])
  schoolCode String
  sections   Section[]
  students   Student[]
}

model Section {
  id             String    @id @default(cuid())
  name           String
  roomNo         String
  classTeacher   Teacher   @relation(fields: [classTeacherId], references: [id])
  classTeacherId String
  class          Class     @relation(fields: [classId], references: [id])
  classId        String
  students       Student[]
}
